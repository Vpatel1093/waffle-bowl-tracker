<!-- Waffle Bowl Bracket Component -->
<div class="space-y-4 sm:space-y-6">
    {% if bracket and bracket.teams %}
        <!-- Bracket Status -->
        {% if bracket_status %}
        <div class="bg-gradient-to-r from-amber-500 to-amber-600 rounded-lg shadow-md p-4 sm:p-6 text-white -mt-4 sm:-mt-6 -mx-4 sm:-mx-6 mb-4 sm:mb-6">
            <div class="flex items-center justify-center">
                <div class="text-center">
                    <h2 class="text-xl sm:text-2xl font-bold mb-1 sm:mb-2">Current Status</h2>
                    <p class="text-base sm:text-lg">{{ bracket_status.message }}</p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Participating Teams -->
        <div class="mb-4 sm:mb-6">
            <h3 class="text-base sm:text-lg md:text-xl font-bold text-gray-900 mb-2 md:mb-4">Waffle Bowl Participants</h3>
            <div class="grid grid-cols-3 md:grid-cols-3 lg:grid-cols-6 gap-2">
                {% for team in bracket.teams %}
                    <div class="bg-gray-100 rounded-lg p-2 md:p-3 border-2 border-gray-300 cursor-pointer hover:border-amber-500 transition"
                         onclick="showTeamModal('{{ team.team_id }}')">
                        <div class="text-xs text-gray-500 mb-1">#{{ team.waffle_seed }}</div>
                        <div class="font-semibold text-sm md:text-base text-gray-900 truncate">{{ team.name }}</div>
                        <div class="text-xs md:text-sm text-gray-600">{{ team.wins }}-{{ team.losses }}</div>
                        <div class="text-xs text-gray-500 hidden md:block">{{ "%.1f"|format(team.points_for) }} pts</div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Bracket Rounds -->
        <div class="space-y-4 sm:space-y-8">
            <!-- Quarterfinals -->
            {% if bracket.rounds.quarterfinals %}
                <div class="bg-gray-50 rounded-lg p-4 sm:p-6">
                    <div class="flex items-center justify-between gap-2 mb-3 sm:mb-4 flex-wrap sm:flex-nowrap">
                        <h3 class="text-base sm:text-lg font-bold text-gray-900">
                            Quarterfinals - Week {{ bracket.rounds.quarterfinals.week }}
                        </h3>
                        {% if bracket_status and bracket_status.current_round == 'quarterfinals' %}
                            <span class="px-2 sm:px-3 py-0.5 sm:py-1 bg-green-100 text-green-800 text-xs sm:text-sm font-semibold rounded-full whitespace-nowrap">
                                In Progress
                            </span>
                        {% endif %}
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        {% for matchup in bracket.rounds.quarterfinals.matchups %}
                            <div class="bg-white rounded-lg border-2 border-gray-300 p-4 cursor-pointer hover:border-amber-500 hover:shadow-lg transition"
                                 onclick="showMatchupModal('qf', {{ loop.index0 }})">
                                <div class="text-xs text-gray-500 mb-3 text-center font-semibold">
                                    ü•û Matchup {{ loop.index }} - Click for details ü•û
                                </div>

                                <!-- Team 1 -->
                                <div class="flex items-center justify-between p-3 rounded {% if matchup.loser and matchup.loser.team_id == matchup.team1.team_id %}bg-red-50{% elif matchup.winner and matchup.winner.team_id == matchup.team1.team_id %}bg-green-50{% else %}bg-gray-50{% endif %} mb-2">
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-900">{{ matchup.team1.name }}</div>
                                        <div class="text-xs text-gray-500">Seed #{{ matchup.team1.waffle_seed }}</div>
                                    </div>
                                    <div class="text-2xl font-bold text-gray-900 ml-4">
                                        {% if matchup.team1.points_by_week and bracket.rounds.quarterfinals.week in matchup.team1.points_by_week %}
                                            {{ "%.1f"|format(matchup.team1.points_by_week[bracket.rounds.quarterfinals.week]) }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Team 2 -->
                                <div class="flex items-center justify-between p-3 rounded {% if matchup.loser and matchup.loser.team_id == matchup.team2.team_id %}bg-red-50{% elif matchup.winner and matchup.winner.team_id == matchup.team2.team_id %}bg-green-50{% else %}bg-gray-50{% endif %}">
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-900">{{ matchup.team2.name }}</div>
                                        <div class="text-xs text-gray-500">Seed #{{ matchup.team2.waffle_seed }}</div>
                                    </div>
                                    <div class="text-2xl font-bold text-gray-900 ml-4">
                                        {% if matchup.team2.points_by_week and bracket.rounds.quarterfinals.week in matchup.team2.points_by_week %}
                                            {{ "%.1f"|format(matchup.team2.points_by_week[bracket.rounds.quarterfinals.week]) }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </div>
                                </div>

                                {% if matchup.loser %}
                                    <div class="mt-3 text-center text-sm bg-amber-50 rounded p-2 border border-amber-200">
                                        <span class="text-amber-700 font-semibold">
                                            üíß {{ matchup.loser.name }} ‚Üí
                                        </span>
                                        <span class="text-gray-600">One step closer to the syrup!</span>
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Byes -->
                    {% if bracket.rounds.quarterfinals.byes %}
                        <div class="mt-4 bg-yellow-50 rounded-lg border border-yellow-200 p-4">
                            <div class="text-sm font-semibold text-yellow-900 mb-2">üßá Sticky Situation - Auto-Advance to Semifinals</div>
                            <div class="grid grid-cols-2 gap-3">
                                {% for team in bracket.rounds.quarterfinals.byes %}
                                    <div class="bg-white rounded p-3 border border-yellow-300">
                                        <div class="font-semibold text-gray-900">{{ team.name }}</div>
                                        <div class="text-xs text-gray-500">Seed #{{ team.waffle_seed }}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Semifinals -->
            {% if bracket.rounds.semifinals %}
                <div class="bg-gray-50 rounded-lg p-4 sm:p-6">
                    <div class="flex items-center justify-between gap-2 mb-3 sm:mb-4 flex-wrap sm:flex-nowrap">
                        <h3 class="text-base sm:text-lg font-bold text-gray-900">
                            Semifinals - Week {{ bracket.rounds.semifinals.week }}
                        </h3>
                        {% if bracket_status and bracket_status.current_round == 'semifinals' %}
                            <span class="px-2 sm:px-3 py-0.5 sm:py-1 bg-green-100 text-green-800 text-xs sm:text-sm font-semibold rounded-full whitespace-nowrap">
                                In Progress
                            </span>
                        {% endif %}
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        {% for matchup in bracket.rounds.semifinals.matchups %}
                            <div class="bg-white rounded-lg border-2 border-gray-300 p-4 {% if matchup.team1 and matchup.team2 %}cursor-pointer hover:border-amber-500 hover:shadow-lg transition{% endif %}"
                                 {% if matchup.team1 and matchup.team2 %}onclick="showMatchupModal('sf', {{ loop.index0 }})"{% endif %}>
                                <div class="text-xs text-gray-500 mb-3 text-center font-semibold">
                                    Semifinal {{ loop.index }}{% if matchup.team1 and matchup.team2 %} - Click for details{% endif %}
                                </div>

                                {% if matchup.team1 %}
                                    <div class="flex items-center justify-between p-3 rounded bg-gray-50 mb-2">
                                        <div>
                                            <div class="font-semibold">{{ matchup.team1.name }}</div>
                                            <div class="text-xs text-gray-500">From QF</div>
                                        </div>
                                        <div class="text-2xl font-bold ml-4">
                                            {% if matchup.team1.points_by_week and bracket.rounds.semifinals.week in matchup.team1.points_by_week %}{{ "%.1f"|format(matchup.team1.points_by_week[bracket.rounds.semifinals.week]) }}{% else %}0.0{% endif %}
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="p-3 rounded bg-gray-100 mb-2 text-gray-500 text-center">
                                        Awaiting QF result
                                    </div>
                                {% endif %}

                                <div class="flex items-center justify-between p-3 rounded bg-yellow-50 border border-yellow-200">
                                    <div>
                                        <div class="font-semibold">{{ matchup.team2.name }}</div>
                                        <div class="text-xs text-yellow-700">Bye Team</div>
                                    </div>
                                    <div class="text-2xl font-bold ml-4">
                                        {% if matchup.team2.points_by_week and bracket.rounds.semifinals.week in matchup.team2.points_by_week %}{{ "%.1f"|format(matchup.team2.points_by_week[bracket.rounds.semifinals.week]) }}{% else %}0.0{% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            <!-- Finals -->
            {% if bracket.rounds.finals %}
                <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-lg p-4 sm:p-6 border-2 border-amber-400">
                    <div class="flex items-center justify-between gap-2 mb-3 sm:mb-4 flex-wrap sm:flex-nowrap">
                        <h3 class="text-lg sm:text-2xl font-bold text-amber-900 flex items-center flex-wrap">
                            <span class="mr-1 sm:mr-2">üßá</span>
                            <span>THE SYRUP SHOWDOWN</span>
                            <span class="text-sm sm:text-xl ml-1 sm:ml-2">Week {{ bracket.rounds.finals.week }}</span>
                        </h3>
                        {% if bracket_status and bracket_status.current_round == 'finals' %}
                            <span class="px-2 sm:px-3 py-0.5 sm:py-1 bg-red-100 text-red-800 text-xs sm:text-sm font-semibold rounded-full whitespace-nowrap">
                                LIVE
                            </span>
                        {% endif %}
                    </div>

                    {% set final = bracket.rounds.finals.matchup %}
                    <div class="bg-white rounded-lg border-4 border-amber-500 p-6 {% if final.team1 and final.team2 %}cursor-pointer hover:shadow-xl transition{% endif %}"
                         {% if final.team1 and final.team2 %}onclick="showMatchupModal('final', 0)"{% endif %}>
                        <div class="text-center text-sm text-amber-800 font-semibold mb-4 bg-amber-50 py-2 rounded">
                            üçØ Who gets covered in syrup? üçØ{% if final.team1 and final.team2 %} Click for sticky details!{% endif %}
                        </div>

                        {% if final.team1 %}
                            <div class="flex items-center justify-between p-4 rounded bg-gray-50 mb-3">
                                <div>
                                    <div class="font-bold text-lg">{{ final.team1.name }}</div>
                                    <div class="text-xs text-gray-500">From Semifinal 1</div>
                                </div>
                                <div class="text-3xl font-bold ml-4">
                                    {% if final.team1.points_by_week and bracket.rounds.finals.week in final.team1.points_by_week %}{{ "%.1f"|format(final.team1.points_by_week[bracket.rounds.finals.week]) }}{% else %}0.0{% endif %}
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-4 rounded bg-gray-50">
                                <div>
                                    <div class="font-bold text-lg">{{ final.team2.name }}</div>
                                    <div class="text-xs text-gray-500">From Semifinal 2</div>
                                </div>
                                <div class="text-3xl font-bold ml-4">
                                    {% if final.team2.points_by_week and bracket.rounds.finals.week in final.team2.points_by_week %}{{ "%.1f"|format(final.team2.points_by_week[bracket.rounds.finals.week]) }}{% else %}0.0{% endif %}
                                </div>
                            </div>

                            {% if final.loser %}
                                <div class="mt-6 p-6 syrup-covered border-4 border-amber-600 rounded-lg text-center relative overflow-hidden">
                                    <div class="text-3xl font-bold text-amber-900 mb-3 animate-pulse">
                                        üßá DROWNED IN SYRUP üíß
                                    </div>
                                    <div class="text-2xl font-bold text-amber-950 mb-2">
                                        {{ final.loser.name }}
                                    </div>
                                    <div class="text-lg text-amber-800 italic mt-2">
                                        "All covered, smothered, and scattered" üçØ
                                    </div>
                                    <div class="mt-3 text-sm text-amber-700 font-semibold">
                                        ü•û Official Waffle Bowl Loser ü•û
                                    </div>
                                </div>
                            {% endif %}
                        {% else %}
                            <div class="p-8 text-center text-gray-500">
                                Awaiting semifinal results...
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>

    {% else %}
        <!-- No bracket data -->
        <div class="text-center py-12">
            <div class="text-6xl mb-4">üßá</div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">No bracket data available</h3>
            <p class="text-gray-600">
                Make sure you've configured your LEAGUE_ID in the .env file and run the OAuth setup.
            </p>
        </div>
    {% endif %}
</div>
