<!-- Waffle Bowl Bracket Component -->
<div class="space-y-6">
    {% if bracket and bracket.teams %}
        <!-- Participating Teams -->
        <div class="mb-8">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Waffle Bowl Participants</h3>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                {% for team in bracket.teams %}
                    <div class="bg-gray-100 rounded-lg p-3 border-2 border-gray-300 cursor-pointer hover:border-amber-500 transition"
                         onclick="showTeamModal('{{ team.team_id }}')">
                        <div class="text-xs text-gray-500 mb-1">Seed #{{ team.waffle_seed }}</div>
                        <div class="font-semibold text-gray-900 truncate">{{ team.name }}</div>
                        <div class="text-sm text-gray-600">{{ team.wins }}-{{ team.losses }}</div>
                        <div class="text-xs text-gray-500">{{ "%.1f"|format(team.points_for) }} pts</div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Bracket Rounds -->
        <div class="space-y-8">
            <!-- Quarterfinals -->
            {% if bracket.rounds.quarterfinals %}
                <div class="bg-gray-50 rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">
                            Quarterfinals - Week {{ bracket.rounds.quarterfinals.week }}
                        </h3>
                        {% if bracket_status and bracket_status.current_round == 'quarterfinals' %}
                            <span class="px-3 py-1 bg-green-100 text-green-800 text-sm font-semibold rounded-full">
                                In Progress
                            </span>
                        {% endif %}
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        {% for matchup in bracket.rounds.quarterfinals.matchups %}
                            <div class="bg-white rounded-lg border-2 border-gray-300 p-4 cursor-pointer hover:border-amber-500 hover:shadow-lg transition"
                                 onclick="showMatchupModal('qf', {{ loop.index0 }})">
                                <div class="text-xs text-gray-500 mb-3 text-center font-semibold">
                                    Matchup {{ loop.index }} - Click for details
                                </div>

                                <!-- Team 1 -->
                                <div class="flex items-center justify-between p-3 rounded {% if matchup.loser and matchup.loser.team_id == matchup.team1.team_id %}bg-red-50{% elif matchup.winner and matchup.winner.team_id == matchup.team1.team_id %}bg-green-50{% else %}bg-gray-50{% endif %} mb-2">
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-900">{{ matchup.team1.name }}</div>
                                        <div class="text-xs text-gray-500">Seed #{{ matchup.team1.waffle_seed }}</div>
                                    </div>
                                    <div class="text-2xl font-bold text-gray-900 ml-4">
                                        {% if matchup.team1.points is defined %}
                                            {{ "%.1f"|format(matchup.team1.points) }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Team 2 -->
                                <div class="flex items-center justify-between p-3 rounded {% if matchup.loser and matchup.loser.team_id == matchup.team2.team_id %}bg-red-50{% elif matchup.winner and matchup.winner.team_id == matchup.team2.team_id %}bg-green-50{% else %}bg-gray-50{% endif %}">
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-900">{{ matchup.team2.name }}</div>
                                        <div class="text-xs text-gray-500">Seed #{{ matchup.team2.waffle_seed }}</div>
                                    </div>
                                    <div class="text-2xl font-bold text-gray-900 ml-4">
                                        {% if matchup.team2.points is defined %}
                                            {{ "%.1f"|format(matchup.team2.points) }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </div>
                                </div>

                                {% if matchup.loser %}
                                    <div class="mt-3 text-center text-sm">
                                        <span class="text-red-600 font-semibold">
                                            Loser: {{ matchup.loser.name }} â†’
                                        </span>
                                        <span class="text-gray-600">Advances to Semifinals</span>
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Byes -->
                    {% if bracket.rounds.quarterfinals.byes %}
                        <div class="mt-4 bg-yellow-50 rounded-lg border border-yellow-200 p-4">
                            <div class="text-sm font-semibold text-yellow-900 mb-2">ðŸŽ¯ Byes (Auto-Advance to Semifinals)</div>
                            <div class="grid grid-cols-2 gap-3">
                                {% for team in bracket.rounds.quarterfinals.byes %}
                                    <div class="bg-white rounded p-3 border border-yellow-300">
                                        <div class="font-semibold text-gray-900">{{ team.name }}</div>
                                        <div class="text-xs text-gray-500">Seed #{{ team.waffle_seed }}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Semifinals -->
            {% if bracket.rounds.semifinals %}
                <div class="bg-gray-50 rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">
                            Semifinals - Week {{ bracket.rounds.semifinals.week }}
                        </h3>
                        {% if bracket_status and bracket_status.current_round == 'semifinals' %}
                            <span class="px-3 py-1 bg-green-100 text-green-800 text-sm font-semibold rounded-full">
                                In Progress
                            </span>
                        {% endif %}
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        {% for matchup in bracket.rounds.semifinals.matchups %}
                            <div class="bg-white rounded-lg border-2 border-gray-300 p-4 {% if matchup.team1 and matchup.team2 %}cursor-pointer hover:border-amber-500 hover:shadow-lg transition{% endif %}"
                                 {% if matchup.team1 and matchup.team2 %}onclick="showMatchupModal('sf', {{ loop.index0 }})"{% endif %}>
                                <div class="text-xs text-gray-500 mb-3 text-center font-semibold">
                                    Semifinal {{ loop.index }}{% if matchup.team1 and matchup.team2 %} - Click for details{% endif %}
                                </div>

                                {% if matchup.team1 %}
                                    <div class="flex items-center justify-between p-3 rounded bg-gray-50 mb-2">
                                        <div>
                                            <div class="font-semibold">{{ matchup.team1.name }}</div>
                                            <div class="text-xs text-gray-500">From QF</div>
                                        </div>
                                        <div class="text-2xl font-bold ml-4">
                                            {% if matchup.team1.points is defined %}{{ "%.1f"|format(matchup.team1.points) }}{% else %}-{% endif %}
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="p-3 rounded bg-gray-100 mb-2 text-gray-500 text-center">
                                        Awaiting QF result
                                    </div>
                                {% endif %}

                                <div class="flex items-center justify-between p-3 rounded bg-yellow-50 border border-yellow-200">
                                    <div>
                                        <div class="font-semibold">{{ matchup.team2.name }}</div>
                                        <div class="text-xs text-yellow-700">Bye Team</div>
                                    </div>
                                    <div class="text-2xl font-bold ml-4">
                                        {% if matchup.team2.points is defined %}{{ "%.1f"|format(matchup.team2.points) }}{% else %}-{% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            <!-- Finals -->
            {% if bracket.rounds.finals %}
                <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-lg p-6 border-2 border-amber-400">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-2xl font-bold text-amber-900 flex items-center">
                            <span class="mr-2">ðŸ§‡</span>
                            Waffle Bowl Final - Week {{ bracket.rounds.finals.week }}
                        </h3>
                        {% if bracket_status and bracket_status.current_round == 'finals' %}
                            <span class="px-3 py-1 bg-red-100 text-red-800 text-sm font-semibold rounded-full">
                                LIVE
                            </span>
                        {% endif %}
                    </div>

                    {% set final = bracket.rounds.finals.matchup %}
                    <div class="bg-white rounded-lg border-4 border-amber-500 p-6 {% if final.team1 and final.team2 %}cursor-pointer hover:shadow-xl transition{% endif %}"
                         {% if final.team1 and final.team2 %}onclick="showMatchupModal('final', 0)"{% endif %}>
                        <div class="text-center text-sm text-gray-600 mb-4">
                            Last place on the line!{% if final.team1 and final.team2 %} Click for details{% endif %}
                        </div>

                        {% if final.team1 %}
                            <div class="flex items-center justify-between p-4 rounded bg-gray-50 mb-3">
                                <div>
                                    <div class="font-bold text-lg">{{ final.team1.name }}</div>
                                    <div class="text-xs text-gray-500">From Semifinal 1</div>
                                </div>
                                <div class="text-3xl font-bold ml-4">
                                    {% if final.team1.points is defined %}{{ "%.1f"|format(final.team1.points) }}{% else %}-{% endif %}
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-4 rounded bg-gray-50">
                                <div>
                                    <div class="font-bold text-lg">{{ final.team2.name }}</div>
                                    <div class="text-xs text-gray-500">From Semifinal 2</div>
                                </div>
                                <div class="text-3xl font-bold ml-4">
                                    {% if final.team2.points is defined %}{{ "%.1f"|format(final.team2.points) }}{% else %}-{% endif %}
                                </div>
                            </div>

                            {% if final.loser %}
                                <div class="mt-6 p-4 bg-red-100 border-2 border-red-400 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-red-900 mb-2">
                                        ðŸ§‡ LAST PLACE ðŸ§‡
                                    </div>
                                    <div class="text-xl font-semibold text-red-800">
                                        {{ final.loser.name }}
                                    </div>
                                </div>
                            {% endif %}
                        {% else %}
                            <div class="p-8 text-center text-gray-500">
                                Awaiting semifinal results...
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>

    {% else %}
        <!-- No bracket data -->
        <div class="text-center py-12">
            <div class="text-6xl mb-4">ðŸ§‡</div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">No bracket data available</h3>
            <p class="text-gray-600">
                Make sure you've configured your LEAGUE_ID in the .env file and run the OAuth setup.
            </p>
        </div>
    {% endif %}
</div>
